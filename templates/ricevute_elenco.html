{% extends "base.html" %}
{% block content %}

<h2>Elenco ricevute</h2>

<div class="card">
  <div class="card-body p-0">

<table class="table table-sm table-striped align-middle"
       style="table-layout:fixed; width:100%; margin-bottom:0;">

<style>
  table.table td, table.table th {
    padding: 6px 8px;   /* prima era molto più largo */
    vertical-align: middle;
  }
</style>

<thead>
  <tr>
    <th style="width:90px;">Numero</th>
    <th style="width:90px;">Sezionale</th>
    <th style="width:110px;">Data</th>
    <th style="width:260px;">Socio</th>
    <th class="text-end" style="width:90px;">Importo</th>
    <th style="width:280px;">Azioni</th>
  </tr>
</thead>

  {% for r in ricevute %}
  <tr>
    <td>
      {{ r.numero_progressivo }}/{{ r.anno }}
    </td>

    <td>
      {{ r.sezionale }}
    </td>

    <td>
      {% if r.data_emissione %}
        {{ r.data_emissione[8:10] }}/{{ r.data_emissione[5:7] }}/{{ r.data_emissione[0:4] }}
      {% endif %}
    </td>

    <td style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
      {% if r.cognome or r.nome %}
        {{ r.cognome }} {{ r.nome }}
      {% else %}
        —
      {% endif %}
    </td>

    <td class="text-end" style="width:90px;">
      {{ "%.2f"|format(r.totale or 0) }}
    </td>

   <td>
  <div style="display:flex; gap:8px; align-items:center;">

    <a href="{{ url_for('ricevute_bp.stampa_ricevuta_pdf', ricevuta_id=r.id) }}"
       target="_blank"
       class="btn btn-outline-primary btn-sm"
       style="border-radius:10px; padding:4px 10px; line-height:1.1; height:32px; display:flex; align-items:center;">
      Stampa
    </a>

    <a href="{{ url_for('ricevute_bp.nuova_ricevuta', ricevuta_id=r.id) }}"
       class="btn btn-outline-primary btn-sm"
       style="border-radius:10px; padding:4px 10px; line-height:1.1; height:32px; display:flex; align-items:center;">
      Modifica
    </a>

    <form method="post"
          action="{{ url_for('ricevute_bp.elimina_ricevuta', ricevuta_id=r.id) }}"
          onsubmit="return confirm('Eliminare definitivamente la ricevuta?');"
          style="margin:0;">

      <button type="submit"
              class="btn btn-outline-danger btn-sm"
              style="border-radius:10px; padding:4px 10px; line-height:1.1; height:32px; display:flex; align-items:center;">
        Elimina
      </button>
    </form>

  </div>
</td>
  </tr>
  {% endfor %}
</table>
  </div>
</div>


<div class="mt-3">
  <a class="btn btn-primary" style="border-radius:10px;"
     href="{{ url_for('ricevute_bp.nuova_ricevuta') }}">
    Nuova ricevuta
  </a>
</div>

{% endblock %}