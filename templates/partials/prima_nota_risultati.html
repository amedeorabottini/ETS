{% if saldi %}
<h4>Saldi periodo</h4>
<table width="100%">
  {% for conto, saldo in saldi.items() %}
  <tr>
    <td>{{ conto }}</td>
    <td style="text-align:right; {% if saldo < 0 %}color:red;{% endif %}">
      {{ "%.2f"|format(saldo) }}
    </td>
  </tr>
  {% endfor %}
</table>
<hr>
{% endif %}

{% set ns = namespace(tot_entrate=0, tot_uscite=0) %}

{% for o in operazioni %}
  {% if o.tipo == 'E' %}
    {% set ns.tot_entrate = ns.tot_entrate + o.importo %}
  {% elif o.tipo == 'U' %}
    {% set ns.tot_uscite = ns.tot_uscite + o.importo %}
  {% endif %}
{% endfor %}

<div class="table-wrapper">
  <table width="100%" border="1" cellpadding="6" style="border-collapse:collapse;">
<tr>
  <th style="width:110px;">Data</th>
  <th>Descrizione</th>
  <th style="text-align:right; width:100px;">Entrate</th>
  <th style="text-align:right; width:100px;">Uscite</th>
  <th>Classificazione</th>
  <th style="width:140px;">Conto</th>
  <th style="width:90px; text-align:center;">Azioni</th>
</tr>

<tr id="row-totali" class="row-totali">
  <td></td>
  <td>TOTALI</td>
  <td style="text-align:right;">
    {{ "%.2f"|format(ns.tot_entrate) }}
  </td>
  <td style="text-align:right;">
    {{ "%.2f"|format(ns.tot_uscite) }}
  </td>
  <td></td>
  <td></td>
  <td></td>
</tr>

{% for o in operazioni %}

<!-- VIEW -->
<tr id="row-view-{{ o.id }}"
    data-conto-id="{{ o.conto_id if o.conto_id is not none else 'CASSA' }}"
    data-conto-colore="{{ o.conto_colore or '' }}"
    style="
      background:
        {% if o.conto_id is none %}
          #f0f0f0
        {% else %}
          {{ o.conto_colore or '#ffffff' }}
        {% endif %}
    ">
    
  <td class="data">{{ o.data }}</td>
  <td class="descrizione">{{ o.descrizione }}</td>

  <td class="entrata" style="text-align:right;">
    {% if o.tipo == 'E' %}{{ "%.2f"|format(o.importo) }}{% endif %}
  </td>

  <td class="uscita" style="text-align:right;">
    {% if o.tipo == 'U' %}{{ "%.2f"|format(o.importo) }}{% endif %}
  </td>

  <td class="classificazione"
    data-classificazione-id="{{ o.classificazione_id or '' }}">
  {{ o.classificazione if o.classificazione else "üí± Movimento finanziario" }}
  </td>
  <td>{{ o.conto }}</td>

  <td class="text-center">
  <button type="button"
          class="btn btn-outline-primary btn-sm"
          data-action="edit"
          data-id="{{ o.id }}">
    ‚úèÔ∏è
  </button>

  <button type="button"
          class="btn btn-outline-danger btn-sm"
          data-action="delete"
          data-id="{{ o.id }}">
    üóëÔ∏è
  </button>
</td>
</tr>

<!-- EDIT -->
<tr id="row-edit-{{ o.id }}" style="display:none; background:#ffffe0;">
  <td>
    <input type="date" id="data-{{ o.id }}" value="{{ o.data_iso }}" style="width:100%;">
  </td>

  <td>
    <input type="text" id="descr-{{ o.id }}" value="{{ o.descrizione }}" style="width:100%;">
  </td>

  <td>
    <input type="number" step="0.01" id="in-{{ o.id }}" {% if o.tipo=='E' %}value="{{ o.importo }}"{% endif %} style="width:100%;">
  </td>

  <td>
    <input type="number" step="0.01" id="out-{{ o.id }}" {% if o.tipo=='U' %}value="{{ o.importo }}"{% endif %} style="width:100%;">
  </td>

  <td>
    <select id="cls-{{ o.id }}" style="width:100%;">
      <option value="">‚Äî</option>
      {% for c in conti %}
        <option value="{{ c.id }}" {% if o.classificazione_id == c.id %}selected{% endif %}>
          {{ c.codice }} - {{ c.descrizione }}
        </option>
      {% endfor %}
    </select>
  </td>

  <td>
   <select id="conto-{{ o.id }}" style="width:100%;"
        data-original-conto="{{ o.conto_id if o.conto_id is not none else 'CASSA' }}">

  <option value="">CASSA</option>

  {% for c in conti_correnti %}
    <option value="{{ c.id }}"
            data-conto-color="{{ c.colore if c.colore else '' }}"
            {% if o.conto_id == c.id %}selected{% endif %}>
      {{ c.codice }} - {{ c.nome }}
    </option>
  {% endfor %}
</select>
  </td>

 <td class="text-center">
  <button type="button"
      class="btn btn-success btn-sm"
      data-action="save"
      data-id="{{ o.id }}">
  ‚úîÔ∏è
</button>

<button type="button"
      class="btn btn-secondary btn-sm"
      data-action="cancel"
      data-id="{{ o.id }}">
 ‚ùå
</button>
</td>
</tr>

{% endfor %}
</table>
  
</div>