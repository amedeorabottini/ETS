{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Scadenziario quote soci ‚Äì {{ anno }}</h2>

<!-- ========================= -->
<!-- FILTRI -->
<!-- ========================= -->
<form method="post" class="card card-body mb-4">

  <div class="row g-3 align-items-end">

    <!-- SOCIO -->
    <div class="col-md-3">
      <label class="form-label">Socio</label>
      <input type="text"
             name="q"
             class="form-control"
             placeholder="Nome o cognome"
             value="{{ filtri.q }}">
    </div>

    <!-- QUOTA -->
    <div class="col-md-3">
      <label class="form-label">Quota</label>
      <select name="quota_id" class="form-select">
        <option value="">Tutte</option>
        {% for q in quote %}
          <option value="{{ q.id }}"
            {% if filtri.quota_id == q.id|string %}selected{% endif %}>
            {{ q.nome }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- STATO -->
    <div class="col-md-2">
      <label class="form-label">Stato</label>
      <select name="stato" class="form-select">
        <option value="">Tutti</option>
        <option value="DA_PAGARE" {% if filtri.stato == 'DA_PAGARE' %}selected{% endif %}>Da pagare</option>
        <option value="PAGATA" {% if filtri.stato == 'PAGATA' %}selected{% endif %}>Pagata</option>
      </select>
    </div>

    <!-- DA -->
    <div class="col-md-2">
      <label class="form-label">Da</label>
      <input type="month"
             name="da"
             class="form-control"
             value="{{ filtri.da }}">
    </div>

    <!-- A -->
    <div class="col-md-2">
      <label class="form-label">A</label>
      <input type="month"
             name="a"
             class="form-control"
             value="{{ filtri.a }}">
    </div>

  </div>

  <div class="mt-3">
    <button type="submit" class="btn btn-primary">
      üîç Filtra
    </button>
  </div>

</form>

<!-- ========================= -->
<!-- TABELLA SCADENZIARIO -->
<!-- ========================= -->
{% if righe %}
<table class="table table-striped table-sm">

  <thead>
    <tr>
      <th>Socio</th>
      <th>Quota</th>
      <th>Mese</th>
      <th class="text-end">Importo</th>
      <th>Stato</th>
      <th class="text-center">Azioni</th>
    </tr>
  </thead>

  <tbody>
    {% for r in righe %}
    <tr>

      <td>{{ r.cognome }} {{ r.nome }}</td>

      <td>{{ r.quota_nome }}</td>

      <td>
        {{ "%02d"|format(r.mese) }}/{{ r.anno }}
      </td>

      <td class="text-end">
        {{ "%.2f"|format(r.importo) }} ‚Ç¨
      </td>

      <td>
        {% if r.stato == 'PAGATA' %}
          <span class="badge bg-success">Pagata</span>
        {% else %}
          <span class="badge bg-warning text-dark">Da pagare</span>
        {% endif %}
      </td>

      <td class="text-center">
        {% if r.stato != 'PAGATA' %}
          <button class="btn btn-sm btn-outline-success">
            üí∞ Incassa
          </button>
        {% else %}
          <span class="text-muted small">‚Äî</span>
        {% endif %}
      </td>

    </tr>
    {% endfor %}
  </tbody>

</table>
{% else %}
<p class="text-muted"><i>Nessuna scadenza trovata.</i></p>
{% endif %}

{% endblock %}